[toolchain]
anchor_version = "0.31.1"
solana_version = "2.1.20"
# Getting "thread 'main' panicked at cli/src/lib.rs:545:18:"? Check your toolchain matches the above.

[workspace]
members = ["programs/marginfi", "programs/mocks", "programs/test_transfer_hook"]
# exclude = [
#   "programs/test_transfer_hook",
#   "programs/liquidity-incentive-program",
#   "programs/brick",
# ]

[features]
resolution = true
skip-lint = false

[programs.localnet]
marginfi = "2jGhuVUuy3umdzByFx8sNWUAaf5vaeuDm78RDPEnhrMr"
mocks = "5XaaR94jBubdbrRrNW7DtRvZeWvLhSHkEGU3jHTEXV3C"
spl_single_pool = "SVSPxpvHdN29nkVg9rPapPNDddN5DipNLRUFhyjFThE" # cloned from solana-labs repo (see below)
# liquidity_incentive_program = "Lip1111111111111111111111111111111111111111"
kamino_lending = "KLend2g3cP87fffoy8q1mQqGKjrxjC8boSyAYavgmjD"
kamino_farms = "FarmsPZpWu9i7Kky8tPN37rs2TpmMrAZrC7S7vJa91Hr"
exponent_core = "ExponentnaRg3CQbW6dqQNZKXp7gtZ9DGMp1cwC4HAS7"
exponent_admin = "3D6ojc8vBfDteLBDTTRznZbZRh7bkEGQaYqNkudoTCBQ"

[programs.mainnet]
# liquidity_incentive_program = "LipsxuAkFkwa4RKNzn51wAsW7Dedzt1RNHMkTkDEZUW"
marginfi = "MFv2hWf31Z9kbCa1snEPYctwafyhdvnV7FZnsebVacA"

[registry]
url = "https://api.apr.dev"

[provider]
cluster = "Localnet"
wallet = "~/.config/solana/id.json"

# (remove RUST_LOG= to see bankRun logs)
[scripts]
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/*.spec.ts --exit --require tests/rootHooks.ts"

# Staked collateral tests only
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/s*.spec.ts --exit --require tests/rootHooks.ts"

# Pyth pull test only
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/p*.spec.ts --exit --require tests/rootHooks.ts"

# Emode tests only
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/e*.spec.ts --exit --require tests/rootHooks.ts"

# Basic tests only (01-1X)
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/0*.spec.ts tests/1*.spec.ts --exit --require tests/rootHooks.ts"

# Just the first few tests only (01-09)
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/0*.spec.ts --exit --require tests/rootHooks.ts"

# Emode tests only
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/e*.spec.ts --exit --require tests/rootHooks.ts"

# Kamino tests only
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/k*.spec.ts --exit --require tests/rootHooks.ts"

# Multiple account limits test only
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/m*.spec.ts --exit --require tests/rootHooks.ts"

# Compound interest only
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/z*.spec.ts --exit --require tests/rootHooks.ts"

# Bankruptcy only
# test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/zb*.spec.ts --exit --require tests/rootHooks.ts"

# Exponent tests only
test = "RUST_LOG= yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/ex*.spec.ts --exit --require tests/rootHooks.ts"

[test]
startup_wait = 60000
shutdown_wait = 2000
upgradeable = false

[[test.genesis]]
address = "KLend2g3cP87fffoy8q1mQqGKjrxjC8boSyAYavgmjD"
program = "tests/fixtures/kamino_lending.so"

[[test.genesis]]
address = "FarmsPZpWu9i7Kky8tPN37rs2TpmMrAZrC7S7vJa91Hr"
program = "tests/fixtures/kamino_farms.so"

# To update:
# clone https://github.com/solana-labs/solana-program-library/tree/master and run cargo build-sbf in spl_single_pool
[[test.genesis]]
address = "SVSPxpvHdN29nkVg9rPapPNDddN5DipNLRUFhyjFThE" # spl single pool program
program = "tests/fixtures/spl_single_pool.so"

# To update: clone (https://github.com/exponent-finance/exponent-core/tree/main) then comment out
# `ctx.accounts.create_metadata` and constraints for `token_metadata_program` and `metadata` in
# `initialize_vault`
[[test.genesis]]
address = "ExponentnaRg3CQbW6dqQNZKXp7gtZ9DGMp1cwC4HAS7"
program = "tests/fixtures/exponent_core.so"

# To update:
# clone (https://github.com/exponent-finance/exponent-core/tree/main/programs/exponent_admin) then
# change initialize_admin's fixed admin from ID to the group_admin's fixed wallet 
[[test.genesis]]
address = "3D6ojc8vBfDteLBDTTRznZbZRh7bkEGQaYqNkudoTCBQ"
program = "tests/fixtures/exponent_admin.so"

[test.validator]
bind_address = "0.0.0.0"
ledger = ".anchor/test-ledger"
rpc_port = 8899

[[test.validator.account]]
address = "DeyH7QxWvnbbaVB4zFrf4hoq7Q8z1ZT14co42BGwGtfM"
filename = "tests/fixtures/bonk_bank.json"

[[test.validator.account]]
address = "4kNXetv8hSv9PzvzPZzEs1CTH6ARRRi2b8h6jk1ad1nP"
filename = "tests/fixtures/cloud_bank.json"

[[test.validator.account]]
address = "Fe5QkKPVAh629UPP5aJ8sDZu8HTfe6M26jDQkKyXVhoA"
filename = "tests/fixtures/pyusd_bank.json"

[[test.validator.account]]
address = "8FRFC6MoGGkMFQwngccyu69VnYbzykGeez7ignHVAFSN"
filename = "tests/fixtures/localnet_usdc.json"

[[test.validator.account]]
address = "7UVimffxr9ow1uXYxsr4LHAcV58mLzhmwaeKvJ1pjLiE"
filename = "tests/fixtures/sol_pyth_price_feed.json"

[[test.validator.account]]
address = "H6ARHf6YXhGYeQfUzQNGk6rDNnLBQKrenN712K4AQJEG"
filename = "tests/fixtures/sol_pyth_oracle.json"

[[test.validator.account]]
address = "7qoe1Xmd3WUfPFHQaMYMGwSJT2mU55t3d4C4ZXZ1GJmn"
filename = "tests/fixtures/gappy_user3.json"

[[test.validator.account]]
address = "6pbRghQuRw9AsPJqhrGLFRVYDcvfXeGh4zNdYMt8mods"
filename = "tests/fixtures/gappy_user4.json"

[[test.validator.account]]
address = "4qp6Fx6tnZkY5Wropq9wUYgtFxXKwE6viZxFHg3rdAG8"
filename = "tests/fixtures/mainnet_group.json"